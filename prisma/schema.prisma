generator client {
  provider             = "prisma-client-py"
  //TODO: why is this breaking my ORM
  // https://github.com/prisma/prisma/discussions/25127
  // output               = "../generated/prisma"
  interface            = "asyncio"
  recursive_type_depth = "5"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Options {
  id                Int              @id @default(autoincrement())
  ticker            String           @unique
  underlying_ticker String
  contract_type     String
  expiration_date   DateTime         @db.Timestamptz(6)
  strike_price      Float
  snapshots         OptionSnapshot[]

  @@index([underlying_ticker, expiration_date])
  @@index([strike_price])
  @@map("options")
}

model OptionSnapshot {
  id            Int      @id @default(autoincrement())
  ticker        String
  volume        Float?
  day_change    Float?
  day_close     Float?
  day_open      Float?
  implied_vol   Float?
  last_price    Float?
  last_updated  DateTime @db.Timestamptz(6)
  last_crawled  DateTime  @db.Timestamptz(6)
  open_interest Int?
  greeks        Json?
  option        Options   @relation(fields: [ticker], references: [ticker])

  @@unique([ticker, last_updated])
  @@index([last_updated])
  @@map("option_snapshots")
}
